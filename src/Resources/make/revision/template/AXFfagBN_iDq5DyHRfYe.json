{
    "_contenttype": "template",
    "_finalization_datetime": "2020-04-23T20:33:00+0200",
    "_finalized_by": "theus",
    "body": "{% set targetGroup = app.request.get('_target_group')|default('citizen') %}\r\n{%- if attribute(source, \"menu_#{locale}\")|default(false) -%}\r\n    {% set linkTarget = emsch_search('target', {\r\n      \"_source\": [\"menu_ids\", \"slugs\"],\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"term\": {\r\n                \"locales\": {\r\n                  \"value\": app.request.locale\r\n                }\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"_contenttype\": {\r\n                  \"value\": \"target\"\r\n                }\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"target_group\": {\r\n                  \"value\": targetGroup\r\n                }\r\n              }\r\n            },\r\n            {\r\n              \"terms\": {\r\n                \"menu_ids\": attribute(source, \"menu_#{locale}\")\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    }, 0, 1).hits.hits|default([{}])|first %}\r\n    \r\n    {% set slug = null %}\r\n    {% for uid in linkTarget._source.menu_ids|default([]) %}\r\n        {% if uid in attribute(source, \"menu_#{locale}\") %}\r\n            {% set slug = linkTarget._source.slugs[loop.index0] %}\r\n        {% endif %}\r\n    {% endfor %}\r\n    {{ path('emsch_target_'~targetGroup, {'slug': slug == \"\/\" ? null : slug }) }}\r\n    \r\n{%- elseif attribute(source, \"show_#{locale}\")|default(false) -%}\r\n    {% if source.target_group|default([])|length == 0 %}\r\n        {{ path('emsch_page', {'slug': attribute(source, \"slug_#{locale}\") }) }}\r\n    {% elseif targetGroup in source.target_group|default([]) %}\r\n        {{ path('emsch_target_'~targetGroup, {'slug': attribute(source, \"slug_#{locale}\") }) }}\r\n    {% else %}\r\n        {{ path('emsch_target_'~(source.target_group|first), {'slug': attribute(source, \"slug_#{locale}\") }) }}\r\n    {% endif %}\r\n{%- else -%}\r\n    {{ path('emsch_missing_translation', { 'contentType': source._contenttype, 'ouuid': id }) }}\r\n{%- endif -%}",
    "name": "page.ems_link.twig",
    "_sha1": "b09e0ee2f6df3a5b9f519c35dd719d5cc1509d52",
    "_published_datetime": "2021-01-17T21:33:55+0100"
}